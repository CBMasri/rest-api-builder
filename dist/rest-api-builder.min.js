!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("rest-api-builder",[],t):"object"==typeof exports?exports["rest-api-builder"]=t():e["rest-api-builder"]=t()}(this,(function(){return(()=>{var e={120:(e,t,r)=>{const{pathToRegexp:n,compile:i}=r(68),{MissingIdError:o,MissingPayloadError:a}=r(552),{validateConfig:s,validateEndpoints:p}=r(290),{cleanURLSegment:u}=r(853);e.exports=class{constructor(e={}){const{requestFn:t=null,baseURL:r="",appendSlash:n=!0}=e;s(e),this.requestFn=t,this.baseURL=u(r),this.appendSlash=n,this.defaultActions={list:{method:"get",path:""},retrieve:{method:"get",path:":id"},create:{method:"post",path:""},update:{method:"put",path:":id"},partialUpdate:{method:"patch",path:":id"},destroy:{method:"delete",path:":id"}}}create(e={}){const{path:t="",endpoints:r=[]}=e;if(!t)throw new Error("path is required");if("string"!=typeof t)throw new TypeError("path must be a string");return p(r),r.length?this._createActions(r,t):this._createDefaultActions(t)}_createDefaultActions(e){const t={};for(const[r,n]of Object.entries(this.defaultActions))t[r]=this._requestFn(e,n);return t}_createActions(e,t){const r={};for(let n of e){const e=n.action;this.defaultActions.hasOwnProperty(e)?n=this.defaultActions[e]:n.method=n.method.toLowerCase(),r[e]=this._requestFn(t,n)}return r}_requestFn(e,t){const r=this._idRequired(t),n=this._payloadRequired(t);return async(...i)=>{const{id:s,data:p,extra:u}=this._parseArgs(i,t);if(r){if(void 0===s)throw new o;if(!["string","number","object"].includes(typeof s))throw new TypeError(`Invalid type for id (${typeof s}). Allowed types: string, number, object`)}if(n&&void 0===p)throw new a;const d={method:t.method,url:this._buildUrl(e,t.path,s),...u};return void 0!==p&&(d.data=p),this.requestFn(d)}}_idRequired(e){const t=e.path.includes(":");return["retrieve","update","partialUpdate","destroy"].includes(e.action)||t}_payloadRequired(e){return["post","put","patch"].includes(e.method)}_parseArgs(e,t){let r,n,i;if(this._idRequired(t))r=e[0],i=e[1],this._payloadRequired(t)&&(n=e[1],i=e[2]);else switch(t.method){case"get":case"delete":i=e[0];break;case"post":case"put":case"patch":n=e[0],i=e[1]}return i=i||{},{id:r,data:n,extra:i}}_buildUrl(e,t,r){let o=u(e);if(t){const e=i(t,{encode:encodeURIComponent}),a="object"==typeof r,s=[];if(n(t,s),s.length>0){if(void 0===r)throw new Error("path specifies a named param but no id was given");if(1===s.length){if(a)throw new TypeError("Received non-primitive value for id");o+=`/${e({[s[0].name]:r})}`}else{if(!a)throw new Error("Expected object id for path with multiple named params");o+=`/${e(r)}`}}else o+=`/${e()}`}const a=this.baseURL?`${this.baseURL}/${o}`:`/${o}`;return this.appendSlash?`${a}/`:a}}},61:e=>{e.exports={HTTP_METHODS:["head","get","post","put","patch","delete"],DEFAULT_ACTIONS:["list","retrieve","create","update","partialUpdate","destroy"]}},552:e=>{class t extends Error{constructor(e=""){super(e),Object.defineProperty(this,"message",{value:e}),Object.defineProperty(this,"name",{value:this.constructor.name}),Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,this.constructor):Object.defineProperty(this,"stack",new Error(e).stack)}}class r extends t{constructor(e="Unable to complete request: missing resource identifier"){super(e),this.constructor=r,this.__proto__=r.prototype}}class n extends t{constructor(e="Unable to complete request: payload is required"){super(e),this.constructor=n,this.__proto__=n.prototype}}e.exports={MissingIdError:r,MissingPayloadError:n}},853:e=>{e.exports={cleanURLSegment:function(e){return e.startsWith("/")&&(e=e.slice(1)),e.endsWith("/")&&(e=e.slice(0,-1)),e}}},290:(e,t,r)=>{const{DEFAULT_ACTIONS:n,HTTP_METHODS:i}=r(61);e.exports={validateConfig:function(e){if(!e.hasOwnProperty("requestFn"))throw new Error("requestFn is required");if("function"!=typeof e.requestFn)throw new TypeError("requestFn must be a function");if(e.hasOwnProperty("baseURL")&&"string"!=typeof e.baseURL)throw new TypeError("baseURL must be a string");if(e.hasOwnProperty("appendSlash")&&"boolean"!=typeof e.appendSlash)throw new TypeError("appendSlash must be a boolean")},validateEndpoints:function(e){for(const[t,r]of e.entries()){if(!r.action)throw new Error(`endpoint at pos ${t} is missing an action`);if(!n.includes(r.action)){if(!r.method)throw new Error(`endpoint at pos ${t} is missing a method`);if(!i.includes(r.method.toLowerCase()))throw new Error(`\n          endpoint at pos ${t} has an unknown method: ${r.method}\n\n          The allowed http methods are: ${i.join(", ")}\n        `);if(!r.hasOwnProperty("path"))throw new Error(`endpoint at pos ${t} is missing a path`);if("string"!=typeof r.path)throw new TypeError(`endpoint at pos ${t} has an invalid type for path: ${typeof r.path}`)}}}}},68:(e,t,r)=>{"use strict";function n(e,t){void 0===t&&(t={});for(var r=function(e){for(var t=[],r=0;r<e.length;){var n=e[r];if("*"!==n&&"+"!==n&&"?"!==n)if("\\"!==n)if("{"!==n)if("}"!==n)if(":"!==n)if("("!==n)t.push({type:"CHAR",index:r,value:e[r++]});else{var i=1,o="";if("?"===e[s=r+1])throw new TypeError('Pattern cannot start with "?" at '+s);for(;s<e.length;)if("\\"!==e[s]){if(")"===e[s]){if(0==--i){s++;break}}else if("("===e[s]&&(i++,"?"!==e[s+1]))throw new TypeError("Capturing groups are not allowed at "+s);o+=e[s++]}else o+=e[s++]+e[s++];if(i)throw new TypeError("Unbalanced pattern at "+r);if(!o)throw new TypeError("Missing pattern at "+r);t.push({type:"PATTERN",index:r,value:o}),r=s}else{for(var a="",s=r+1;s<e.length;){var p=e.charCodeAt(s);if(!(p>=48&&p<=57||p>=65&&p<=90||p>=97&&p<=122||95===p))break;a+=e[s++]}if(!a)throw new TypeError("Missing parameter name at "+r);t.push({type:"NAME",index:r,value:a}),r=s}else t.push({type:"CLOSE",index:r,value:e[r++]});else t.push({type:"OPEN",index:r,value:e[r++]});else t.push({type:"ESCAPED_CHAR",index:r++,value:e[r++]});else t.push({type:"MODIFIER",index:r,value:e[r++]})}return t.push({type:"END",index:r,value:""}),t}(e),n=t.prefixes,i=void 0===n?"./":n,o="[^"+p(t.delimiter||"/#?")+"]+?",a=[],s=0,u=0,d="",f=function(e){if(u<r.length&&r[u].type===e)return r[u++].value},c=function(e){var t=f(e);if(void 0!==t)return t;var n=r[u],i=n.type,o=n.index;throw new TypeError("Unexpected "+i+" at "+o+", expected "+e)},h=function(){for(var e,t="";e=f("CHAR")||f("ESCAPED_CHAR");)t+=e;return t};u<r.length;){var l=f("CHAR"),m=f("NAME"),y=f("PATTERN");if(m||y){var v=l||"";-1===i.indexOf(v)&&(d+=v,v=""),d&&(a.push(d),d=""),a.push({name:m||s++,prefix:v,suffix:"",pattern:y||o,modifier:f("MODIFIER")||""})}else{var w=l||f("ESCAPED_CHAR");if(w)d+=w;else if(d&&(a.push(d),d=""),f("OPEN")){v=h();var E=f("NAME")||"",g=f("PATTERN")||"",x=h();c("CLOSE"),a.push({name:E||(g?s++:""),pattern:E&&!g?o:g,prefix:v,suffix:x,modifier:f("MODIFIER")||""})}else c("END")}}return a}function i(e,t){return o(n(e,t),t)}function o(e,t){void 0===t&&(t={});var r=u(t),n=t.encode,i=void 0===n?function(e){return e}:n,o=t.validate,a=void 0===o||o,s=e.map((function(e){if("object"==typeof e)return new RegExp("^(?:"+e.pattern+")$",r)}));return function(t){for(var r="",n=0;n<e.length;n++){var o=e[n];if("string"!=typeof o){var p=t?t[o.name]:void 0,u="?"===o.modifier||"*"===o.modifier,d="*"===o.modifier||"+"===o.modifier;if(Array.isArray(p)){if(!d)throw new TypeError('Expected "'+o.name+'" to not repeat, but got an array');if(0===p.length){if(u)continue;throw new TypeError('Expected "'+o.name+'" to not be empty')}for(var f=0;f<p.length;f++){var c=i(p[f],o);if(a&&!s[n].test(c))throw new TypeError('Expected all "'+o.name+'" to match "'+o.pattern+'", but got "'+c+'"');r+=o.prefix+c+o.suffix}}else if("string"!=typeof p&&"number"!=typeof p){if(!u){var h=d?"an array":"a string";throw new TypeError('Expected "'+o.name+'" to be '+h)}}else{if(c=i(String(p),o),a&&!s[n].test(c))throw new TypeError('Expected "'+o.name+'" to match "'+o.pattern+'", but got "'+c+'"');r+=o.prefix+c+o.suffix}}else r+=o}return r}}function a(e,t){var r=[];return s(f(e,r,t),r,t)}function s(e,t,r){void 0===r&&(r={});var n=r.decode,i=void 0===n?function(e){return e}:n;return function(r){var n=e.exec(r);if(!n)return!1;for(var o=n[0],a=n.index,s=Object.create(null),p=function(e){if(void 0===n[e])return"continue";var r=t[e-1];"*"===r.modifier||"+"===r.modifier?s[r.name]=n[e].split(r.prefix+r.suffix).map((function(e){return i(e,r)})):s[r.name]=i(n[e],r)},u=1;u<n.length;u++)p(u);return{path:o,index:a,params:s}}}function p(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function u(e){return e&&e.sensitive?"":"i"}function d(e,t,r){void 0===r&&(r={});for(var n=r.strict,i=void 0!==n&&n,o=r.start,a=void 0===o||o,s=r.end,d=void 0===s||s,f=r.encode,c=void 0===f?function(e){return e}:f,h="["+p(r.endsWith||"")+"]|$",l="["+p(r.delimiter||"/#?")+"]",m=a?"^":"",y=0,v=e;y<v.length;y++){var w=v[y];if("string"==typeof w)m+=p(c(w));else{var E=p(c(w.prefix)),g=p(c(w.suffix));if(w.pattern)if(t&&t.push(w),E||g)if("+"===w.modifier||"*"===w.modifier){var x="*"===w.modifier?"?":"";m+="(?:"+E+"((?:"+w.pattern+")(?:"+g+E+"(?:"+w.pattern+"))*)"+g+")"+x}else m+="(?:"+E+"("+w.pattern+")"+g+")"+w.modifier;else m+="("+w.pattern+")"+w.modifier;else m+="(?:"+E+g+")"+w.modifier}}if(d)i||(m+=l+"?"),m+=r.endsWith?"(?="+h+")":"$";else{var b=e[e.length-1],T="string"==typeof b?l.indexOf(b[b.length-1])>-1:void 0===b;i||(m+="(?:"+l+"(?="+h+"))?"),T||(m+="(?="+l+"|"+h+")")}return new RegExp(m,u(r))}function f(e,t,r){return e instanceof RegExp?function(e,t){if(!t)return e;for(var r=/\((?:\?<(.*?)>)?(?!\?)/g,n=0,i=r.exec(e.source);i;)t.push({name:i[1]||n++,prefix:"",suffix:"",modifier:"",pattern:""}),i=r.exec(e.source);return e}(e,t):Array.isArray(e)?function(e,t,r){var n=e.map((function(e){return f(e,t,r).source}));return new RegExp("(?:"+n.join("|")+")",u(r))}(e,t,r):function(e,t,r){return d(n(e,r),t,r)}(e,t,r)}r.r(t),r.d(t,{parse:()=>n,compile:()=>i,tokensToFunction:()=>o,match:()=>a,regexpToFunction:()=>s,tokensToRegexp:()=>d,pathToRegexp:()=>f})}},t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}return r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(120)})()}));
//# sourceMappingURL=rest-api-builder.min.map