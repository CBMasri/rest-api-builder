!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("rest-api-builder",[],t):"object"==typeof exports?exports["rest-api-builder"]=t():e["rest-api-builder"]=t()}(this,(function(){return(()=>{"use strict";var e={545:(e,t,r)=>{function i(e,t){void 0===t&&(t={});for(var r=function(e){for(var t=[],r=0;r<e.length;){var i=e[r];if("*"!==i&&"+"!==i&&"?"!==i)if("\\"!==i)if("{"!==i)if("}"!==i)if(":"!==i)if("("!==i)t.push({type:"CHAR",index:r,value:e[r++]});else{var n=1,o="";if("?"===e[a=r+1])throw new TypeError('Pattern cannot start with "?" at '+a);for(;a<e.length;)if("\\"!==e[a]){if(")"===e[a]){if(0==--n){a++;break}}else if("("===e[a]&&(n++,"?"!==e[a+1]))throw new TypeError("Capturing groups are not allowed at "+a);o+=e[a++]}else o+=e[a++]+e[a++];if(n)throw new TypeError("Unbalanced pattern at "+r);if(!o)throw new TypeError("Missing pattern at "+r);t.push({type:"PATTERN",index:r,value:o}),r=a}else{for(var s="",a=r+1;a<e.length;){var p=e.charCodeAt(a);if(!(p>=48&&p<=57||p>=65&&p<=90||p>=97&&p<=122||95===p))break;s+=e[a++]}if(!s)throw new TypeError("Missing parameter name at "+r);t.push({type:"NAME",index:r,value:s}),r=a}else t.push({type:"CLOSE",index:r,value:e[r++]});else t.push({type:"OPEN",index:r,value:e[r++]});else t.push({type:"ESCAPED_CHAR",index:r++,value:e[r++]});else t.push({type:"MODIFIER",index:r,value:e[r++]})}return t.push({type:"END",index:r,value:""}),t}(e),i=t.prefixes,o=void 0===i?"./":i,s="[^"+n(t.delimiter||"/#?")+"]+?",a=[],p=0,u=0,f="",d=function(e){if(u<r.length&&r[u].type===e)return r[u++].value},c=function(e){var t=d(e);if(void 0!==t)return t;var i=r[u],n=i.type,o=i.index;throw new TypeError("Unexpected "+n+" at "+o+", expected "+e)},h=function(){for(var e,t="";e=d("CHAR")||d("ESCAPED_CHAR");)t+=e;return t};u<r.length;){var l=d("CHAR"),y=d("NAME"),m=d("PATTERN");if(y||m){var w=l||"";-1===o.indexOf(w)&&(f+=w,w=""),f&&(a.push(f),f=""),a.push({name:y||p++,prefix:w,suffix:"",pattern:m||s,modifier:d("MODIFIER")||""})}else{var v=l||d("ESCAPED_CHAR");if(v)f+=v;else if(f&&(a.push(f),f=""),d("OPEN")){w=h();var E=d("NAME")||"",g=d("PATTERN")||"",x=h();c("CLOSE"),a.push({name:E||(g?p++:""),pattern:E&&!g?s:g,prefix:w,suffix:x,modifier:d("MODIFIER")||""})}else c("END")}}return a}function n(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function o(e){return e&&e.sensitive?"":"i"}function s(e,t,r){return e instanceof RegExp?function(e,t){if(!t)return e;for(var r=/\((?:\?<(.*?)>)?(?!\?)/g,i=0,n=r.exec(e.source);n;)t.push({name:n[1]||i++,prefix:"",suffix:"",modifier:"",pattern:""}),n=r.exec(e.source);return e}(e,t):Array.isArray(e)?function(e,t,r){var i=e.map((function(e){return s(e,t,r).source}));return new RegExp("(?:"+i.join("|")+")",o(r))}(e,t,r):function(e,t,r){return function(e,t,r){void 0===r&&(r={});for(var i=r.strict,s=void 0!==i&&i,a=r.start,p=void 0===a||a,u=r.end,f=void 0===u||u,d=r.encode,c=void 0===d?function(e){return e}:d,h="["+n(r.endsWith||"")+"]|$",l="["+n(r.delimiter||"/#?")+"]",y=p?"^":"",m=0,w=e;m<w.length;m++){var v=w[m];if("string"==typeof v)y+=n(c(v));else{var E=n(c(v.prefix)),g=n(c(v.suffix));if(v.pattern)if(t&&t.push(v),E||g)if("+"===v.modifier||"*"===v.modifier){var x="*"===v.modifier?"?":"";y+="(?:"+E+"((?:"+v.pattern+")(?:"+g+E+"(?:"+v.pattern+"))*)"+g+")"+x}else y+="(?:"+E+"("+v.pattern+")"+g+")"+v.modifier;else y+="("+v.pattern+")"+v.modifier;else y+="(?:"+E+g+")"+v.modifier}}if(f)s||(y+=l+"?"),y+=r.endsWith?"(?="+h+")":"$";else{var b=e[e.length-1],A="string"==typeof b?l.indexOf(b[b.length-1])>-1:void 0===b;s||(y+="(?:"+l+"(?="+h+"))?"),A||(y+="(?="+l+"|"+h+")")}return new RegExp(y,o(r))}(i(e,r),t,r)}(e,t,r)}r.r(t),r.d(t,{default:()=>h});class a extends Error{constructor(e=""){super(e),Object.defineProperty(this,"message",{value:e}),Object.defineProperty(this,"name",{value:this.constructor.name}),Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,this.constructor):Object.defineProperty(this,"stack",new Error(e).stack)}}class p extends a{constructor(e="Unable to complete request: missing resource identifier"){super(e),this.constructor=p,this.__proto__=p.prototype}}class u extends a{constructor(e="Unable to complete request: payload is required"){super(e),this.constructor=u,this.__proto__=u.prototype}}const f=["head","get","post","put","patch","delete"],d=["list","retrieve","create","update","partialUpdate","destroy"];function c(e){return e.startsWith("/")&&(e=e.slice(1)),e.endsWith("/")&&(e=e.slice(0,-1)),e}class h{constructor(e={}){const{baseURL:t="",requestFn:r=null}=e;!function(e){if(!e.hasOwnProperty("requestFn"))throw new Error("requestFn is required");if("function"!=typeof e.requestFn)throw new TypeError("requestFn must be a function");if(e.hasOwnProperty("baseURL")&&"string"!=typeof e.baseURL)throw new TypeError("baseURL must be a string")}(e),this.baseURL=c(t),this.requestFn=r,this.defaultActions={list:{method:"get",path:""},retrieve:{method:"get",path:":id"},create:{method:"post",path:""},update:{method:"put",path:":id"},partialUpdate:{method:"patch",path:":id"},destroy:{method:"delete",path:":id"}}}create(e={}){const{path:t="",endpoints:r=[]}=e;if(!t)throw new Error("path is required");if("string"!=typeof t)throw new TypeError("path must be a string");return function(e){for(const[t,r]of e.entries()){if(!r.action)throw new Error(`endpoint at pos ${t} is missing an action`);if(!d.includes(r.action)){if(!r.method)throw new Error(`endpoint at pos ${t} is missing a method`);if(!f.includes(r.method.toLowerCase()))throw new Error(`\n          endpoint at pos ${t} has an unknown method: ${r.method}\n\n          The allowed http methods are: ${f.join(", ")}\n        `);if(!r.hasOwnProperty("path"))throw new Error(`endpoint at pos ${t} is missing a path`);if("string"!=typeof r.path)throw new TypeError(`endpoint at pos ${t} has an invalid type for path: ${typeof r.path}`)}}}(r),r.length?this._createActions(r,t):this._createDefaultActions(t)}_createDefaultActions(e){const t={};for(const[r,i]of Object.entries(this.defaultActions))t[r]=this._requestFn(e,i);return t}_createActions(e,t){const r={};for(let i of e){const e=i.action;this.defaultActions.hasOwnProperty(e)?i=this.defaultActions[e]:i.method=i.method.toLowerCase(),r[e]=this._requestFn(t,i)}return r}_requestFn(e,t){const r=this._idRequired(t),i=this._payloadRequired(t);return async(...n)=>{const{id:o,data:s,extra:a}=this._parseArgs(n,t);if(r){if(void 0===o)throw new p;if(!["string","number","object"].includes(typeof o))throw new TypeError(`Invalid type for id (${typeof o}). Allowed types: string, number, object`)}if(i&&void 0===s)throw new u;const f={method:t.method,url:this._buildUrl(e,t.path,o),...a};return void 0!==s&&(f.data=s),this.requestFn(f)}}_idRequired(e){const t=e.path.includes(":");return["retrieve","update","partialUpdate","destroy"].includes(e.action)||t}_payloadRequired(e){return["post","put","patch"].includes(e.method)}_parseArgs(e,t){let r,i,n;if(this._idRequired(t))r=e[0],n=e[1],this._payloadRequired(t)&&(i=e[1],n=e[2]);else switch(t.method){case"get":case"delete":n=e[0];break;case"post":case"put":case"patch":i=e[0],n=e[1]}return n=n||{},{id:r,data:i,extra:n}}_buildUrl(e,t,r){let n=c(e);if(t){const e=(a={encode:encodeURIComponent},function(e,t){void 0===t&&(t={});var r=o(t),i=t.encode,n=void 0===i?function(e){return e}:i,s=t.validate,a=void 0===s||s,p=e.map((function(e){if("object"==typeof e)return new RegExp("^(?:"+e.pattern+")$",r)}));return function(t){for(var r="",i=0;i<e.length;i++){var o=e[i];if("string"!=typeof o){var s=t?t[o.name]:void 0,u="?"===o.modifier||"*"===o.modifier,f="*"===o.modifier||"+"===o.modifier;if(Array.isArray(s)){if(!f)throw new TypeError('Expected "'+o.name+'" to not repeat, but got an array');if(0===s.length){if(u)continue;throw new TypeError('Expected "'+o.name+'" to not be empty')}for(var d=0;d<s.length;d++){var c=n(s[d],o);if(a&&!p[i].test(c))throw new TypeError('Expected all "'+o.name+'" to match "'+o.pattern+'", but got "'+c+'"');r+=o.prefix+c+o.suffix}}else if("string"!=typeof s&&"number"!=typeof s){if(!u){var h=f?"an array":"a string";throw new TypeError('Expected "'+o.name+'" to be '+h)}}else{if(c=n(String(s),o),a&&!p[i].test(c))throw new TypeError('Expected "'+o.name+'" to match "'+o.pattern+'", but got "'+c+'"');r+=o.prefix+c+o.suffix}}else r+=o}return r}}(i(t,a),a)),p="object"==typeof r,u=[];if(s(t,u),u.length>0){if(void 0===r)throw new Error("path specifies a named param but no id was given");if(1===u.length){if(p)throw new TypeError("Received non-primitive value for id");n+=`/${e({[u[0].name]:r})}/`}else{if(!p)throw new Error("Expected object id for path with multiple named params");n+=`/${e(r)}/`}}else n+=`/${e()}/`}var a;return this.baseURL?`${this.baseURL}/${n}`:`/${n}`}}}},t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={exports:{}};return e[i](n,n.exports,r),n.exports}return r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(545)})()}));
//# sourceMappingURL=rest-api-builder.min.map